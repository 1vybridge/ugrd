#!/bin/bash

KERNEL_VERSION="${2:?}"

# Do not attempt to create initramfs if the supplied image is already a UKI
if [[ "$KERNEL_INSTALL_IMAGE_TYPE" = "uki" ]]; then
    exit 0
fi

if [[ "${KERNEL_INSTALL_INITRD_GENERATOR:-ugrd}" != "ugrd" ]]; then
    exit 0
fi

ugrd $([[ $KERNEL_INSTALL_VERBOSE == 1 ]] && echo --debug) --kver "$KERNEL_VERSION" "$KERNEL_INSTALL_STAGING_AREA/initrd" || exit 1
